### Question 1:

If CSRF token is automatically on every user request, then clicking on hacker link will not send the our token automatically with the malicious link to the SBI bank?

### Answer 1:

Great question! Here's how the CSRF token is managed by the server (like SBI Bank in this case) and how you don't need to manually specify it in your HTML form.

### Key Concept: **The CSRF Token is Automatically Provided by the Server**
The CSRF token is **generated by the server** when you log in, and it's **automatically included** in the web pages and forms that are part of your session. As a user, you don't have to manually know or add the CSRF token yourself—it’s handled automatically by the web application.

### Here's how it works step-by-step:

### 1. **Server Generates the CSRF Token:**
- When you log in to SBI's website, the server generates a **unique CSRF token** for your session. This token is stored on the **server-side** and is linked to your active session.
- This token is also stored in a **cookie** (in the user's browser) and is tied to your session.

### 2. **Token is Sent to Your Browser:**
- Whenever you load a page or a form (for example, when you visit the "Transfer Funds" page), the server **automatically includes the CSRF token** in the HTML form.
- This token is included either:
    - **As a hidden form field** within the page's HTML form, or
    - **In a custom header** (if you're using AJAX or JavaScript-based requests).

### 3. **Example of Form with CSRF Token:**
- In the HTML form, you don’t need to explicitly add the CSRF token. Instead, the web application’s backend automatically **injects** the token into the form when it generates the page.

For example, the form might look like this:
   ```html
   <form action="/transfer" method="POST">
       <input type="text" name="amount" value="1000">
       <input type="hidden" name="csrfToken" value="randomlyGeneratedCSRFToken"> <!-- CSRF token auto-filled by the server -->
       <input type="submit" value="Transfer">
   </form>
   ```

In the above example, the `csrfToken` hidden input field gets automatically filled by the server with a **valid token** (e.g., `randomlyGeneratedCSRFToken`) when the page is loaded. **You, as the user, do not need to do anything to get this token.**

### 4. **Token is Sent Back with the Request:**
- When you click the **Submit** button to transfer funds, the browser sends the form data **along with the CSRF token** back to the server.

For example, the request sent to the server could look like this:
   ```plaintext
   POST /transfer HTTP/1.1
   Host: sbi-bank.com
   Content-Type: application/x-www-form-urlencoded
   
   amount=1000&csrfToken=randomlyGeneratedCSRFToken
   ```

### 5. **Server Verifies the CSRF Token:**
- When the server receives the request, it checks whether the CSRF token in the form (i.e., `randomlyGeneratedCSRFToken`) matches the one stored in your session.
- If the tokens match, the request is processed (e.g., the money transfer is completed).
- If they do not match, the request is rejected as **potentially malicious**.

### 6. **How It’s Done Automatically in Web Frameworks (like Spring Security):**
- **Spring Security** (or similar web frameworks) takes care of this process for you. It generates the CSRF token on the server side and injects it into the HTML form automatically.
- In **Spring Security**, the CSRF token is typically added to the page using a special tag:
  ```html
  <form action="/transfer" method="POST">
      <input type="text" name="amount" value="1000">
      <input type="hidden" name="_csrf" value="${_csrf.token}"> <!-- Spring adds the CSRF token automatically -->
      <input type="submit" value="Transfer">
  </form>
  ```

- Here, Spring automatically injects the token into the form as the hidden field `_csrf`.

### Why Do You Not Need to Know the Token?
You don't need to know the CSRF token because it is **generated** and **managed** by the web server and framework, which:
- Sends the token to the browser (in cookies or as hidden fields).
- Automatically includes it in the form.
- Verifies it upon form submission to ensure it's a legitimate request from you, the authenticated user.

### **In Summary:**
- The **SBI server** generates a CSRF token for your session.
- The **token is automatically inserted** into the form by the server when the page loads.
- You **don’t need to know** the token or manually add it to the form.
- When you submit the form, the token is sent with the request, and the server validates it to make sure the request is legitimate and not a CSRF attack.